<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org/"
    xmlns:sec="http://www.w3.org/1999/xhtml">

<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>STYLE | 내 프로필 관리</title>
    <link data-n-head="ssr" rel="icon" type="image/x-icon" href="https://kream.co.kr/favicon.ico">

    <!-- jquery cdn -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!--axios cdn -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- session -->

    <link rel="stylesheet" href="../../css/social/myprofile.css">
    <link rel="stylesheet" href="../../css/pop.css">
</head>

<body>
    <input type="hidden" id="idx" th:value="${id}">
    <!-- head.html -->


    <!--<div th:replace="include/pop :: pop"></div>-->
    <div id="pop"></div>
    <!-- head.html 끝-->
    <div id="fixed"></div>

    <!-- 본문 -->
    <div id="__nuxt"><!---->
        <div id="__layout">
            <div tabindex="0" class="wrap win_os lg"><!---->
                <div>
                    <header th:fragment="head">
                        <meta charset="UTF-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <link rel="stylesheet" href="../../css/social/style_header.css">
                        <div>
                            <div class="social header lg no_line">
                                <div class="header_top">
                                    <div class="top_inner">
                                        <ul class="top_list">
                                            <li class="top_item">
                                                <a href="/notice" class="top_link"> 고객센터 </a>
                                            </li>
                                            <li class="top_item">
                                                <a href="/my/wish" class="top_link"> 관심상품 </a>
                                            </li>
                                            <li class="top_item">
                                                <a href="/my" class="top_link"> 마이페이지 </a>
                                            </li>
                                            <li class="top_item" style="display: none;">
                                                <a href="/login" class="top_link"> 로그인 </a>
                                            </li>
                                            <li class="top_item">
                                                <a href="/" class="top_link"> 로그아웃 </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="header_main">
                                    <div class="main_inner">
                                        <h1>
                                            <a href="/" aria-label="홈" class="logo">
                                                <img src="../../img/shoekream_logo.png"
                                                    class="logo-kream icon sprite-icons">
                                            </a>
                                        </h1>
                                        <div class="gnb_area">
                                            <nav class="gnb">
                                                <ul class="gnb_list">
                                                    <li class="gnb_item gnb_on">
                                                        <a href="/social/trending" class="gnb_link"> STYLE </a>
                                                    </li>
                                                    <li class="gnb_item">
                                                        <a href="#" class="gnb_link"> SHOP </a>
                                                    </li>
                                                    <li class="gnb_item">
                                                        <a href="/about" target="_blank" class="gnb_link"> ABOUT </a>
                                                    </li>
                                                </ul>
                                            </nav>
                                            <div class="search_btn_box">
                                                <a aria-label="검색" href="#" class="btn_search">
                                                    <img src="../../img/search.png"
                                                        class="nav-search icon sprite-icons">
                                                </a>
                                            </div>
                                        </div>
                                        <div style="display: none;">
                                            <div class="search_area" value="">
                                                <div class="search">
                                                    <img src="../../img/search.png">
                                                    <input type="text" placeholder="" title="검색창"
                                                        class="input_search show_placeholder_on_focus">
                                                    <button class="btn_search_delete" style="display: none;">
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="nav_btn_box">
                                            <button type="button" aria-label="검색" class="btn_search">
                                            </button>
                                            <button type="button" aria-label="메뉴" class="btn_menu">
                                            </button>
                                        </div>
                                        <div style="display: none;">
                                            <div class="navigation_wrap">
                                                <div class="navigation">
                                                    <div class="navigation_inner">
                                                        <ul class="nav_list">
                                                            <li class="nav_item">
                                                                <a href="#" class="nav_link"> STYLE </a>
                                                            </li>
                                                            <li class="nav_item">
                                                                <a href="#" class="nav_link"> SHOP </a>
                                                            </li>
                                                            <li class="nav_item">
                                                                <a href="#" class="nav_link"> 자주 묻는 질문 </a>
                                                            </li>
                                                            <li class="nav_item">
                                                                <a href="#" class="nav_link"> 공지사항 </a>
                                                            </li>
                                                            <li class="nav_item" style="display: none;">
                                                                <a href="#" class="nav_link"> 로그인 </a>
                                                            </li>
                                                            <li class="nav_item">
                                                                <a href="#" class="nav_link"> 마이 페이지 </a>
                                                            </li>
                                                        </ul>
                                                        <div class="nav_logout">
                                                            <button class="btn_logout">로그아웃</button>
                                                            <p class="text_mail"></p>
                                                        </div>
                                                        <div class="nav_download">
                                                            <p class="download_txt">KREAM 앱 설치 후 사용해 보세요!</p>
                                                            <div class="btn_appdown">
                                                                <a href="#" class="btn outline medium"> 앱 다운로드 </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button type="button" aria-label="닫기" class="btn_nav_close">
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <!---->
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
                </header>
                <div class="social_header">
                    <div class="title_user" style="display: none;">
                        <div class="profile_img_box"><img src="../../img/kream_empty_img.png" alt="8izhs1"
                                class="profile_img"></div>
                        <p class="user_name">8izhs1</p>
                    </div>
                </div>
            </div><!---->
            <div social="" class="container social lg">
                <div class="content">
                    <div class="social_user_area">
                        <div class="user_top">
                            <div class="profile_img_box"><img src="../../img/kream_empty_img.png" alt="KREAM 프로필 이미지"
                                    class="profile_img"></div>
                            <div class="profile_info_box">
                                <p class="user_name"> 8izhs1<!----></p><!---->
                            </div>
                        </div>
                        <div class="user_explain">
                            <p class="main_txt">m15701313</p><!---->
                        </div>
                        <!-- 버튼  -->
                        <div class="btn_container">
                            <a href="/my/profile" class="btn btn outlinegrey small" type="button"> 프로필 수정 </a>
                            <!-- <a href="/social/users/@8izhs1" class="btn btn btn_my_style outlinegrey small"
                                type="button"> 내 스타일 </a> -->
                        </div>
                        <!-- 버튼 끝 -->
                    </div>

                    <div class="social_tab">
                        <ul class="tab_list">
                            <li class="tab_item"><a href="#" class="tab_link"><span class="tab_menu">게시물</span><span
                                        class="menu_count">0</span></a></li>
                            <li class="tab_item"><a href="#" class="tab_link"><span class="tab_menu">팔로워</span><span
                                        class="menu_count">0</span></a></li>
                            <li class="tab_item"><a href="#" class="tab_link"><span class="tab_menu">팔로잉</span><span
                                        class="menu_count">3</span></a></li>
                        </ul>
                    </div>
                    <div class="social_feeds_empty top_line">
                        <div class="empty_box">
                            <img src="../../img/camera_icon.png" alt="게시물 없음">
                            <strong class="empty_title">게시물 없음</strong>
                            <p class="empty_txt">앱에서 사진을 공유하면 내 프로필에 표시됩니다.</p><!---->
                        </div>
                    </div><!----><!---->
                </div>
            </div>
            <!-- 푸터 -->
            <footer th:fragment="checkFooter">

                <div class="footer_flex_box2">
                    <div id="footer_left_box2">
                        <div class="footer_box_text2" id="fbtext2_left">
                            <div class="fbb2_Btext">이용안내</div>
                            <ul>
                                <li><a onclick="pop_inspecion()">검수기준</a></li>
                                <li><a onclick="pop_policy()">이용정책</a></li>
                                <li><a onclick="pop_penalty()">패널티 정책</a></li>
                                <li><a onclick="pop_commu()">커뮤니티 가이드라인</a></li>
                            </ul>
                        </div>
                        <div class="footer_box_text2">
                            <div class="fbb2_Btext">고객지원</div>
                            <ul>
                                <li><a href="/notice">공지사항</a></li>
                                <li><a href="/about">서비스 소개</a></li>
                                <li><a href="https://www.kream.co.kr/showroom">쇼룸 안내</a></li>
                                <li><a href="https://www.kream.co.kr/about/seller_reception">판매자 방문접수</a></li>
                            </ul>
                        </div>
                    </div>
                    <div id="footer_right_box2">
                        <div class="fbb2_Btext">고객센터 1588-7813</div>
                        <ul>
                            <li>운영시간평일 11:00 - 18:00 (토 ∙ 일, 공휴일 휴무)</li>
                            <li>점심시간평일 13:00 - 14:00</li>
                        </ul>
                        <div id="footer_ask_text">1:1 문의하기는 앱에서만 가능합니다.</div>
                        <div id="footer_ask_box"><a href="/faq">자주 묻는 질문</a></div>
                    </div>
                </div>
                <div class="footer_flex_box3">
                    <div id="footer_box3">
                        <div id="footer_box3_1">
                            <ul id="footer_box3_1_text">
                                <li><a href="https://www.kreamcorp.com/">회사소개</a></li>
                                <li><a href="https://recruit.kreamcorp.com/kream/recruitMain">인재채용</a></li>
                                <li class="no_moblie"><a href="https://www.kreamcorp.com/view/contact.html">제휴제안</a>
                                </li>
                                <li><a href="https://www.kream.co.kr/agreement">이용약관</a></li>
                                <li id="policy"><a href="https://www.kream.co.kr/privacy">개인정보처리방침</a></li>
                            </ul>
                            <ul id="sns_and_button">
                                <ul id="sns_img">
                                    <li id="insta_img"><a href="https://www.instagram.com/kream.co.kr/"></a></li>
                                    <li id="facebook_img"><a href="https://www.facebook.com/kreamcokr"></a></li>
                                    <li id="chat_img"><a href="https://pf.kakao.com/_adpxlxb"></a></li>
                                </ul>
                                <li id="footer_button" onclick="business_info()">사업자정보 <div class="up_down_img"></div>
                                </li>
                            </ul>
                        </div>
                        <div id="footer_box3_2" class="business_info">
                            <ul>
                                <li>크림 주식회사 · 대표 김창욱</li>
                                <li>사업자등록번호: 570-88-01618 <a href="#">사업자정보확인</a></li>
                                <li>통신판매업: 제 2021-성남분당C-0093호</li>
                            </ul>
                            <ul>
                                <li>사업장소재지: 경기도 성남시 분당구 분당내곡로 117, 8층</li>
                                <li>개인정보관리책임자: 김미진</li>
                                <li>호스팅 서비스: 네이버 클라우드 (주)</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="footer_flex_box4">
                    <p id="footer_left_box4">크림(주)는 통신판매 중개자로서 통신판매의 당사자가 아니므로 개별 판매자가 등록한 상품정보에 대해서 책임을 지지 않습니다. 단,
                        거래과정에서 검수하고 보증하는 내용에 대한 책임은 당사에 있습니다.</p>
                    <p id="footer_right_box4">© 2021 KREAM.Corp.</p>
                </div>
            </footer>
            <!-- 푸터 끝 -->
            <div>

            </div>
        </div>
    </div>
    </div>


    <!-- 본문 끝 -->

    <!-- 팝업 -->
    <div id="background1" style="display: none;">
        <div class="p_container">
            <div class="p_title">팔로워<span></span>
                <button onclick="follower_down()">
                    <img src="/lib/img/x.png" alt="">
                </button>
            </div>
        </div>
    </div>

    <div id="background2" style="display: none;">
        <div class="p_container">
            <div class="p_title">팔로잉<span></span>
                <button onclick="following_down()">
                    <img src="/lib/img/x.png" alt="">
                </button>
            </div>
        </div>
    </div>
    <hr />


    <!-- footer -->
    <!--<div th:replace="include/checkFooter :: footer"></div>-->
    <div id="footer"></div>
    <!-- Layer content-->

    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="../../js/style/profile.js"></script>
    <script src="../../static/lib/js/pop.js"></script>
</body>

<script>
    const sessionId = sessionStorage.getItem('userid'); // 세션 가져오기

    $(function () {
        axios.get('/api/style_user_list/' + sessionId, {
        }).then(function (response) {
            console.log(response);

            let main = $('<div id="container">');
            let hash = $('<p class="text" style="text-align: initial">');
            let background1 = $('<div class="p_title">');
            let background2 = $('<div class="p_title">');

            for (let i in response.data.data) {
                let userid = response.data.data[i].userid;
                let name = response.data.data[i].name;
                let intro = response.data.data[i].intro;
                let userImg = response.data.data[i].userImg;
                let boardCnt = response.data.data[i].boardCnt;
                let followerCnt = response.data.data[i].followerCnt;
                let followingCnt = response.data.data[i].followingCnt;
                let styleImg = response.data.data[i].styleImg;
                let content = response.data.data[i].content;
                let hit = response.data.data[i].hit;
                let replyCnt = response.data.data[i].replyCnt;
                let p_img = response.data.data[i].styleProductTagApiResponseList[i].originFileName;
                let p_name = response.data.data[i].styleProductTagApiResponseList[i].name;
                let p_price = response.data.data[i].styleProductTagApiResponseList[i].price;
                let styleId = response.data.data[i].styleId;
                let hitBoolean = response.data.data[i].hitBoolean;

                let likeImg = '/lib/img/smile.png';
                //좋아요 기록이 true일 경우 이미지 변경
                if (hitBoolean == true) {
                    likeImg = '/lib/img/heart.png';
                }
                let price = p_price;
                //즉시구매가가 없는 경우
                if (p_price == null) {
                    price = '-';
                }
                for (let z in response.data.data[i].styleHashTagNameApiResponseList) {
                    hashtag = response.data.data[i].styleHashTagNameApiResponseList[z].tagName;
                    if (hashtag > response.data.data[i].styleHashTagNameApiResponseList[0].tagName) {
                        hash.append('#' + hashtag);

                    } else {
                        hash.append(content + '#' + hashtag);
                    }
                }

                let con = $('<div id="profile_box">').append(
                    '<div><img src="/lib/product/' + userImg + '" alt="" id="profile">' + '<p class="userid">' + userid + '</p></div>' +
                    '<div id="profile_text"><p class="username">' + name + '</p><p class="intro">' + intro + '</p></div>' + '<div id="user_button"><button><a href="/social/myprofile/edit">프로필 수정</a></button>' +
                    '<button><a href="/social/upload">새글 올리기</a></button></div></div>' + '<div id="count_box"><ul><li><a href="#"><span>게시물</span><span class="count">' + boardCnt + '</span></a></li>' +
                    '<li onclick="follower_up()"><span>팔로워</span> <span class="count">' + followerCnt + '</span></li><li onclick="following_up()"><span>팔로잉</span> <span class="count">' + followingCnt + '</span></li></ul></div>' +
                    '<div id="Box"><div class="card_box"><a href="/social/popular"><div class="imgbox">' + '<img src="/lib/product/' + styleImg + '" alt="" class="img"></div>' + '<div class="userbox"><img src="/lib/product/' + userImg + '" alt="" class="userimg">' +
                    '<p class="userid">' + userid + '</p></div>' + '</a><div class="likebox"><div class="likelink"><img src="' + likeImg + '" alt="" class="like_img" onclick="sendit(' + styleId + ')">' + '<p>' + hit + '</p></div>' +
                    '<a href="#" class="likelink"><img src="/lib/img/7148750_chat_message_bubble_talk_conversation_icon.png" alt="" class="comment"><p>' + replyCnt + '</p></a></div>' +
                    '<a href="/product/121" class="product_box"><div>' + '<img src="/lib/product/' + p_img + '" alt="" class="product_img"></div>' + '<div class="product_text"><p>' + p_name + '</p><div>' +
                    '<span class="product_price">' + priceToString(p_price) + '</span><span>원</span></div></div></a></div></div></div>'
                )
                main.append(con);

                // 팔로우
                for (let j in response.data.data[i].followerListApiResponseList) {
                    follower_id = response.data.data[i].followerListApiResponseList[j].id;
                    let follower_img = response.data.data[i].followerListApiResponseList[j].originFileName;
                    let follower_name = response.data.data[i].followerListApiResponseList[j].name;
                    let follower_profileName = response.data.data[i].followerListApiResponseList[j].profileName;

                    let cam = $('<div class="p_body">').append(
                        '<div class="p_user"><div class="p_imgbox">' + '<img src="/lib/product/' + follower_img + '" alt="" id="p_img"></div>' +
                        '<div class="p_textbox"><p class="p_text1">' + follower_name + '</p><p class="p_text2">' + follower_profileName + '</p></div></div>' +
                        '<div class="p_btnbox"><button class="p_btn">팔로우</button></div></div>'
                    )
                    cam.append('</div>');
                    background1.append(cam);
                }


                // 팔로잉
                for (let k in response.data.data[i].followingListApiResponseList) {
                    following_id = response.data.data[i].followingListApiResponseList[k].id;
                    let following_img = response.data.data[i].followingListApiResponseList[k].originFileName;
                    let following_name = response.data.data[i].followingListApiResponseList[k].name;
                    let following_profileName = response.data.data[i].followingListApiResponseList[k].profileName;

                    let doit = $('<div class="p_body">').append(
                        '<div class="p_user"><div class="p_imgbox">' + '<img src="/lib/product/' + following_img + '" alt="" id="p_img"></div>' +
                        '<div class="p_textbox"><p class="p_text1">' + following_name + '</p><p class="p_text2">' + following_profileName + '</p></div></div>' +
                        '<div class="p_btnbox"><button class="p_btn">팔로우</button></div></div></div>'
                    )
                    doit.append('</div>');
                    background2.append(doit);
                }
            }
            $('#container').html(main);
            $('#background1 > .p_container > .p_title').after(background1);
            $('#background2 > .p_container > .p_title').after(background2);
            $('.userbox').after(hash);


        }).catch(function (error) {
            console.log(error);
        })
    });
    // 가격 ,(콤마) 생성
    function priceToString(p_price) {
        return p_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }
    // 좋아요 버튼
    function sendit(styleId) {
        let likeNum = document.getElementById(styleId);
        if (customerId == null) {
            location.href = '/login';
        } else {
            axios.get('/api/styleLike_like/' + customerId + "/" + styleId, {
            }).then(function (response) {
                console.log(response)
                let like = response.data;
                likeNum.innerText = '';
                likeNum.append(like);
            });
        }
    }
    $(document).on('click', '.like_img', function () {
        /*$(".check_box").index(this); 몇번쨰 클래스인지 가져옴 // .index는 함수이름*/
        let index = $(".like_img").index(this);
        let like = document.getElementsByClassName('like_img');
        let likeCheck = like.item(index).getAttribute('src');
        if (customerId != null) {    // 로그인 되어있을 경우에만 바꿔줌
            if (likeCheck == '/lib/img/smile.png') {
                like.item(index).setAttribute('src', '/lib/img/heart.png');
            } else if (likeCheck == '/lib/img/heart.png') {
                like.item(index).setAttribute('src', '/lib/img/smile.png');
            }
        } else {
            location.href = '/login';
        }
    });

    /* 팔로잉 버튼 */
    follow = [];
    $(document).on('click', '.p_btnbox', function () {
        let followerId = sessionId; // 본인
        let followingId = $('#idx').val();
        let index = $(".p_btnbox").index(this);

        axios.get('/api/follow_link/' + followingId + '/' + followerId).then(function () {

            if (follow[index] != 1) {
                followBoolean = false;
                follow[index] = 1;
                const button = document.getElementsByClassName("p_btn")[index];
                console.log(button);
                button.innerText = "팔로잉";
                button.style.backgroundColor = "white";
                button.style.color = "black";
            } else if (follow[index] == 1) {
                followBoolean = true;
                follow[index] = 0;
                const button = document.getElementsByClassName("p_btn")[index];
                button.innerText = "팔로우";
                button.style.backgroundColor = "black";
                button.style.color = "white";
            }
        })
    });



    $(document).on('click', '#like_img', function () {
        /*$(".check_box").index(this); 몇번쨰 클래스인지 가져옴 // .index는 함수이름*/
        let index = $("#like_icon").index(this);
        let like = document.getElementById('like_img');
        let likeCheck = like.getAttribute('src');
        // if(customerId!=null){    // 로그인 되어있을 경우에만 바꿔줌
        if (likeCheck == '../../static/lib/styleImg/like_icon.png') {
            like.setAttribute('src', '../../static/lib/styleImg/like_after_icon.png');
            // .like_count++;
        } else if (likeCheck == '../../static/lib/styleImg/like_after_icon.png') {
            like.setAttribute('src', '../../static/lib/styleImg/like_icon.png');
        }
        // }else{
        //     location.href='../login.html';
        // }
    });
</script>

</html>